package com.example.demo.service;

import java.util.HashMap;
import java.util.Map;
import java.util.Random;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.mail.SimpleMailMessage;
import org.springframework.mail.javamail.JavaMailSender;
import org.springframework.stereotype.Service;

@Service
public class EmailService {

	@Autowired
	private JavaMailSender mailSender;

	private Map<String, Integer> otpStore = new HashMap<>();

	// 1. OTP
	public int sendOtp(String email) {
		Random random = new Random();
		int otp = random.nextInt(900000) + 100000;

		otpStore.put(email, otp);

		SimpleMailMessage m = new SimpleMailMessage();
		m.setTo(email);
		m.setSubject("Your e-Sevai OTP Verification");
		m.setText("Your OTP: " + otp);
		mailSender.send(m);

		return otp;
	}

	public boolean verifyOtp(String email, int otp) {
		if (otpStore.containsKey(email) && otpStore.get(email) == otp) {
			otpStore.remove(email);
			return true;
		}
		return false;
	}

	// 2. Application Submitted Mail
	public void sendApplicationMail(String toEmail, String fullName, String certificateType, Long appId, String date) {

		String subject = "Your Application Has Been Submitted Successfully - Tamil Nadu e-Sevai";

		String body = "Dear " + fullName + ",\n\n"
				+ "Thank you for applying through the Tamil Nadu e-Sevai online portal.\n"
				+ "Your application has been submitted successfully and is currently under review.\n\n" +

				"Your application details are provided below:\n"
				+ "------------------------------------------------------------\n" + "ğŸ“Œ Applicant Name          : "
				+ fullName + "\n" + "ğŸ“Œ Certificate / Scheme    : " + certificateType + "\n"
				+ "ğŸ“Œ Application ID          : " + appId + "\n" + "ğŸ“Œ Submission Date         : " + date + "\n"
				+ "ğŸ“Œ Current Status          : Pending Verification\n"
				+ "------------------------------------------------------------\n\n" +

				"ğŸ“ What Happens Next?\n" + "- Your application will be verified by the concerned department.\n"
				+ "- If additional information or documents are required, you will be notified through email.\n"
				+ "- Once approved, you will be able to download your certificate from the e-Sevai user dashboard.\n\n"
				+

				"ğŸ“‚ Important Notes:\n" + "- Please keep your Application ID safe for future reference.\n"
				+ "- Ensure your registered mobile number and email remain active.\n"
				+ "- Do not share your personal details or documents with unknown persons.\n\n" +

				"ğŸ“¢ Need Assistance?\n"
				+ "For help regarding your application, please visit your nearest e-Sevai centre\n"
				+ "or contact the District e-Sevai Support Team.\n\n" +

				"Thank you for using Tamil Nadu e-Sevai digital services.\n"
				+ "We remain committed to providing fast, transparent, and citizen-friendly services.\n\n" +

				"Warm Regards,\n" + "Tamil Nadu e-Sevai Team\n" + "Tamil Nadu e-Governance Agency (TNeGA)\n"
				+ "Government of Tamil Nadu\n";

		SimpleMailMessage mail = new SimpleMailMessage();
		mail.setTo(toEmail);
		mail.setSubject(subject);
		mail.setText(body);

		mailSender.send(mail);
	}

	// 3. Approved Mail
	public void sendApprovedMail(String toEmail, String fullName, String certificateType) {

	    String subject = "Your Application Has Been Approved - Tamil Nadu e-Sevai";

	    String body =
	            "Dear " + fullName + ",\n\n" +
	            "We are happy to inform you that your application submitted through the Tamil Nadu e-Sevai portal has been successfully APPROVED.\n\n" +

	            "Your approved application details are provided below:\n" +
	            "------------------------------------------------------------\n" +
	            "ğŸ“Œ Applicant Name          : " + fullName + "\n" +
	            "ğŸ“Œ Certificate / Scheme    : " + certificateType + "\n" +
	            "ğŸ“Œ Approval Status         : Approved\n" +
	            "ğŸ“Œ Issued By               : Tamil Nadu e-Governance Agency (TNeGA)\n" +
	            "------------------------------------------------------------\n\n" +

	            "ğŸ“„ Certificate Download:\n" +
	            "Your certificate is now available for download in your e-Sevai user dashboard.\n" +
	            "â€¢ Go to the 'My Applications' section.\n" +
	            "â€¢ Select your approved application.\n" +
	            "â€¢ Click on 'Download Certificate'.\n\n" +

	            "ğŸ“ Important Instructions:\n" +
	            "- Please keep a digital and printed copy of your certificate for future use.\n" +
	            "- Ensure your personal details on the certificate are correct.\n" +
	            "- If you notice any errors, visit your nearest e-Sevai center for correction.\n" +
	            "- Do **not** share your certificate or OTP with unknown persons.\n\n" +

	            "ğŸ“¢ Need Help?\n" +
	            "If you face any issue in downloading the certificate, please contact your District e-Sevai Support Team or raise a service request on the portal.\n\n" +

	            "Thank you for using Tamil Nadu e-Sevai.\n" +
	            "We are committed to providing faster, transparent, and citizen-friendly services.\n\n" +

	            "Warm Regards,\n" +
	            "Tamil Nadu e-Sevai Team\n" +
	            "Tamil Nadu e-Governance Agency (TNeGA)\n" +
	            "Government of Tamil Nadu\n";

	    SimpleMailMessage mail = new SimpleMailMessage();
	    mail.setTo(toEmail);
	    mail.setSubject(subject);
	    mail.setText(body);

	    mailSender.send(mail);
	}


	// 4. Rejected Mail
	public void sendRejectedMail(String toEmail, String fullName, String certificateType, String reason) {

		String body = "Dear " + fullName + ",\n\n" + "Your application for '" + certificateType
				+ "' has been REJECTED.\n\n" + "Reason: " + (reason != null ? reason : "Not specified") + "\n\n"
				+ "You may reapply after correcting the issue.\n\n" + "Regards,\nTamil Nadu e-Sevai";

		SimpleMailMessage mail = new SimpleMailMessage();
		mail.setTo(toEmail);
		mail.setSubject("Your Application Has Been Rejected");
		mail.setText(body);

		mailSender.send(mail);
	}
}
